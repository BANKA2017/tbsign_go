# TbSignâ¡ï¸ (Dev)

---

åªæ˜¯ä¸€ä¸ªç­¾åˆ°ç¨‹åºï¼Œå¯ä»¥é…åˆ[ç™¾åº¦è´´å§äº‘ç­¾åˆ°](https://github.com/MoeNetwork/Tieba-Cloud-Sign/)ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹è¿ä½œ

## âš  è­¦å‘Š

- éšç¼˜ç»´æŠ¤ï¼Œä¸ä¿è¯ä¸ä¼šå°å·ï¼Œè¯·**ä¸è¦**ç”¨äºä¸»åŠ›è´¦å·ï¼ï¼ï¼
- ä¸æ¥å—ä»»ä½•è·¯çº¿å›¾ä»¥å¤–çš„ PRï¼Œè·¯çº¿å›¾å†…çš„ PR ä¸ä¸€å®šä¼šæ¥å—

## flags

| flag     | default          | description                        |
| :------- | :--------------- | :--------------------------------- |
| username |                  | æ•°æ®åº“å¸å·                         |
| pwd      |                  | æ•°æ®åº“å¯†ç                          |
| endpoint | `127.0.0.1:3306` | æ•°æ®åº“ç«¯ç‚¹                         |
| db       | `tbsign`         | æ•°æ®åº“åç§°                         |
| db_path  |                  | SQLite æ–‡ä»¶ç›®å½•                    |
| test     | `false`          | æµ‹è¯•æ¨¡å¼ï¼Œæ­¤æ¨¡å¼ä¸‹ä¸ä¼šè¿è¡Œè®¡åˆ’ä»»åŠ¡ |
| api      | `false`          | æ˜¯å¦å¯åŠ¨åç«¯ api                   |
| address  | `:1323`          | åç«¯è¿è¡Œåœ°å€                       |
| setup    | `false`          | å®‰è£…ç¨‹åº                           |

ç¤ºä¾‹

```shell
go run main.go --username=<dbUsername> --pwd=<DBPassword>
# or
./tbsign_go --username=<dbUsername> --pwd=<DBPassword>
# or https://github.com/cosmtrek/air
air -- --db_path=tbsign.db --test=true --api=true
```

## env

ä¸æ”¯æŒ `.env` æ–‡ä»¶ï¼Œè¯·ç›´æ¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨é¡ºåºæ˜¯ `flags` > `env` > `default`

| flag        | description                        |
| :---------- | :--------------------------------- |
| tc_username | æ•°æ®åº“å¸å·                         |
| tc_pwd      | æ•°æ®åº“å¯†ç                          |
| tc_endpoint | æ•°æ®åº“ç«¯ç‚¹                         |
| tc_db       | æ•°æ®åº“åç§°                         |
| tc_db_path  | SQLite æ–‡ä»¶ç›®å½•                    |
| tc_test     | æµ‹è¯•æ¨¡å¼ï¼Œæ­¤æ¨¡å¼ä¸‹ä¸ä¼šè¿è¡Œè®¡åˆ’ä»»åŠ¡ |
| tc_api      | æ˜¯å¦å¯åŠ¨åç«¯ api                   |
| tc_address  | åç«¯è¿è¡Œåœ°å€                       |

## æ•°æ®åº“

åªè¦ `db_path`/`tc_db_path` çš„å€¼ä¸ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå°±ä¼šä½¿ç”¨ SQLiteï¼›å¦åˆ™ä½¿ç”¨ MySQL

## å®‰è£…

- è¿ç§»æ³• (ä»… MySQL)
  - ç›´æ¥å®‰è£… [ç™¾åº¦è´´å§äº‘ç­¾åˆ°](https://github.com/MoeNetwork/Tieba-Cloud-Sign/)
  - ä½¿ç”¨åŸæ•°æ®åº“é…ç½®å¯åŠ¨
- å…¨æ–°å®‰è£… (MySQL, SQLite)
  - è‡ªåŠ¨å®‰è£…
  - å¯åŠ¨ç¨‹åºï¼Œæ·»åŠ  `flag` `setup=true` (ç¤ºä¾‹: `./tbsign_go --db=tbsign.db --api=true --address=:8080 --setup=true`)
  - æ ¹æ®æ–‡å­—æç¤ºå®Œæˆè‡ªåŠ¨å®‰è£…æµç¨‹

    ```plaintext
    âœ  tbsign_go git:(master) âœ— ./tbsign_go --db_path=tbsign1.db --api=true --setup=true
    2024/06/29 18:18:47 tbsign: sqlite connected!
    ğŸ“Œç°åœ¨æ­£åœ¨å®‰è£… TbSignâ¡ï¸ï¼Œå¦‚æœæ•°æ®åº“å†…å«æœ‰æ•°æ®ï¼Œè¿™æ ·åšä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œè¯·æå‰åšå¥½å¤‡ä»½ã€‚å¦‚æœå·²ç»å®Œæˆå¤‡ä»½ï¼Œè¯·è¾“å…¥ä»¥ä¸‹éšæœºæ•°å­—å¹¶æŒ‰ä¸‹å›è½¦ï¼ˆæ˜¾ç¤ºä¸º "--> 1234 <--" ä»£è¡¨éœ€è¦è¾“å…¥ "1234"ï¼‰
    --> 428650691 <--
    è¯·è¾“å…¥: 428650691
    âŒ›æ­£åœ¨æ¸…ç†æ—§è¡¨
    âŒ›æ­£åœ¨å»ºç«‹æ•°æ®è¡¨å’Œç´¢å¼•
    âŒ›æ­£åœ¨å¯¼å…¥æ•°æ®...
    âŒ›å¯¼å…¥ç¬¬1é¡¹...
    âŒ›å¯¼å…¥ç¬¬2é¡¹...
    ğŸ”’æ³¨å†Œç®¡ç†å‘˜å¸å·...
    ç®¡ç†å‘˜ç”¨æˆ·å: a
    ç®¡ç†å‘˜é‚®ç®±: a@a.a
    ç®¡ç†å‘˜å¯†ç  (æ³¨æ„ç©ºæ ¼): a
    âŒ›æ­£åœ¨æ³¨å†Œç®¡ç†å‘˜å¸å·...
    ğŸ‰å®‰è£…æˆåŠŸï¼è¯·ç§»é™¤æ‰ `--setup=true` åé‡æ–°æ‰§è¡Œæœ¬æ–‡ä»¶ä»¥å¯åŠ¨ç³»ç»Ÿ
    âœ  go_tbsign git:(master) âœ— ./tbsign_go --db_path=tbsign1.db --api=true
    ```

  - å»æ‰ `--setup=true`ï¼Œå¯åŠ¨ç¨‹åº
  - \*(é€‰åš) ç™»å½•ç®¡ç†å‘˜å¸å·ï¼Œæ‰“å¼€ **ç³»ç»Ÿç®¡ç†** å³å¯æ‰‹åŠ¨å¼€å¯è‡ªå¸¦æ’ä»¶

### å…¼å®¹æ€§

- [âš ï¸] é€šè¿‡ *è¿ç§»æ³•* å¯åŠ¨çš„ç¨‹åºèƒ½å¤Ÿä¸ [ç™¾åº¦è´´å§äº‘ç­¾åˆ°](https://github.com/MoeNetwork/Tieba-Cloud-Sign/) å…±å­˜ï¼Œä½†æ— æ³•ä½¿ç”¨ *ç”¨æˆ·æˆé•¿ä»»åŠ¡* æ’ä»¶ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæœªå…¬å¼€çš„æ’ä»¶
- [âŒ] é€šè¿‡ *å…¨æ–°å®‰è£…* å¯åŠ¨çš„ç¨‹åºæ— æ³•å…¼å®¹ [ç™¾åº¦è´´å§äº‘ç­¾åˆ°](https://github.com/MoeNetwork/Tieba-Cloud-Sign/)ï¼Œå› ä¸ºç¼ºå°‘ç›¸å…³æ•°æ®è¡¨å’Œè®¾ç½®é€‰é¡¹

## å‰ç«¯

â¡ï¸ <https://github.com/BANKA2017/tbsign_go_fe>

## Api (WIP)

ä»…ä¾›å‚è€ƒï¼Œæœªæ¥å¯èƒ½è¿˜ä¼šå¤§æ”¹ï¼Œç­‰åˆ°ç¨³å®šåéšç¼˜å‡ºæ–‡æ¡£å’Œå‰ç«¯

## æ’ä»¶

éƒ¨åˆ†åŠŸèƒ½æ¥è‡ªåŸç‰ˆå®˜æ–¹æ’ä»¶

- [x] [è‡ªåŠ¨åˆ·æ–°è´´å§åˆ—è¡¨](https://github.com/MoeNetwork/Tieba-Cloud-Sign/tree/master/plugins/ver4_ref)
- [x] [åäººå ‚](https://github.com/MoeNetwork/Tieba-Cloud-Sign/tree/master/plugins/ver4_rank)
- [x] [å¾ªç¯å°ç¦](https://github.com/MoeNetwork/Tieba-Cloud-Sign/tree/master/plugins/ver4_ban)
- [x] ?ç”¨æˆ·æˆé•¿ä»»åŠ¡(beta)

## å·²çŸ¥é—®é¢˜

- [x] ä¸æ”¯æŒé™åˆ¶å•æ¬¡ç­¾åˆ°è´´å§æ€»æ•°ï¼Œä¼šä¸€æ¬¡æ€§å…¨éƒ¨ç­¾å®Œ
- [x] æ²¡æœ‰çµæ´»çš„è¯·æ±‚é—´éš”å’Œè¯·æ±‚å¤´æ¨¡æ‹Ÿï¼Œæœ‰å°å·çš„é£é™©
- [x] åªæœ‰ç­¾åˆ°è¿™ä¸€ä¸ªåŠŸèƒ½ï¼Œå¯¹é‡ç­¾çš„å¤„ç†çº¦ç­‰äºæ²¡æœ‰
- [ ] æ··ä¹±çš„è¾“å‡ºï¼Œéšå¤„å¯è§çš„æ‰“ç‚¹
- [ ] æ²¡æœ‰è¿›è¡Œä»»ä½•ä¼˜åŒ–
- [x] ä¸€æ¬¡æ€§æ‰§è¡Œï¼Œä»ç„¶éœ€è¦ cron
- [x] ä¼šè¿è¡Œæœªå®‰è£…/æœªæ¿€æ´»çš„æ’ä»¶
- [ ] é‚€è¯·ç ç³»ç»Ÿåœ¨è€ƒè™‘è¦ä¸è¦åšï¼Œå¦‚æœä¸æƒ³åšå°±ä¼šç§»å…¥**ä¸ä¼šè§£å†³åˆ—è¡¨**
- [x] é‚®ç®±ç›¸å…³â€¦â€¦é‚®ç®±æ‰¾å›âœ…

**ä¸‹é¢æåˆ°çš„ä¸ä¼šè§£å†³**

- å…¼å®¹æ€§
  - [x] ä¸ä¼šå¯¹æ‰€è°“çš„ vip å¸å·æœ‰ä»»ä½•ç‰¹æ®Šç…§é¡¾ï¼ŒåŸ vip å¸å·çš„ç‰¹æƒä¹Ÿä¼šä¸‹æ”¾ç»™æ‰€æœ‰è´¦å·
  - [x] æ— æ³•æ”¯æŒä¸€ä¸ªè´´å§è´¦å·ç»‘å®šåˆ°å¤šä¸ªäº‘ç­¾å¸å·
  - [x] ä¸åŒè¯­è¨€å„æœ‰ç‰¹æ€§ï¼Œä¸ä¼šå¼ºæ±‚ 1:1 å…¼å®¹
  - [x] ä¸æ”¯æŒè‡ªå®šä¹‰çš„æ•°æ®è¡¨å‰ç¼€ï¼Œç»Ÿä¸€ä½¿ç”¨é»˜è®¤å‰ç¼€ `tc_`
  - [x] ä¸æ”¯æŒåˆ†è¡¨
  - [x] ç™»å½•/æ³¨å†Œä¸ä¼šæœ‰éªŒè¯ç 
- æ¥å£
  - [x] å¾ªç¯å°ç¦æ— æ³•ç¡®è®¤å°ç¦æ˜¯å¦æˆåŠŸï¼Œå› ä¸ºè¿”å›çš„ç»“æœæ˜¯ä¸€æ ·çš„
  - [x] æ‰§è¡Œæˆé•¿ä»»åŠ¡æ—¶æ— æ³•ç¡®è®¤æ˜¯å¦é‡å¤æ‰§è¡Œï¼ŒåŸå› åŒä¸Š

## TODO

- [ ] è§£å†³å·²çŸ¥é—®é¢˜
- [ ] å…¼å®¹å®˜æ–¹å·²æ”¶å½•æ’ä»¶ä¸­å…³äºè´´å§çš„éƒ¨åˆ†
  - [x] [è‡ªåŠ¨åˆ·æ–°è´´å§åˆ—è¡¨](https://github.com/MoeNetwork/Tieba-Cloud-Sign/tree/master/plugins/ver4_ref)
  - [x] [åäººå ‚](https://github.com/MoeNetwork/Tieba-Cloud-Sign/tree/master/plugins/ver4_rank)
  - [x] [å¾ªç¯å°ç¦](https://github.com/MoeNetwork/Tieba-Cloud-Sign/tree/master/plugins/ver4_ban)
  - [ ] [åˆ è´´æœº](https://github.com/MoeNetwork/Tieba-Cloud-Sign/tree/master/plugins/ver4_review)ï¼ˆå¯èƒ½ä¼šæ‹–å¾ˆä¹…ç”šè‡³ä¸ä¼šåšï¼‰
- [ ] ä¼˜åŒ– PHP åŸç‰ˆçš„ç›¸å…³åŠŸèƒ½
- [x] ä¸å†è€ƒè™‘ ~~é€šè¿‡è¯»å– `config.php` å–å¾—æ•°æ®åº“è¿æ¥ä¿¡æ¯~~
- [x] è‡ªåŠ¨æ¸…ç†è§£é™¤ç»‘å®šçš„å¸å·çš„æ’ä»¶è®¾ç½®
- [ ] æ‰“åŒ…/Docker/æˆ–è€…åˆ«çš„
- [ ] å®Œå–„æƒé™æ§åˆ¶
- [ ] â€¦â€¦æ›´å¤šçš„æƒ³èµ·æ¥å†åŠ 

## æ„Ÿè°¢

- [ç™¾åº¦è´´å§äº‘ç­¾åˆ°](https://github.com/MoeNetwork/Tieba-Cloud-Sign/)
- [Starry-OvO/aiotieba](https://github.com/Starry-OvO/aiotieba/)
