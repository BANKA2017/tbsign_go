# TbSignâ¡ï¸

---

åªæ˜¯ä¸€ä¸ªç­¾åˆ°ç¨‹åºï¼Œå¯ä»¥é…åˆ[ç™¾åº¦è´´å§äº‘ç­¾åˆ°](https://github.com/MoeNetwork/Tieba-Cloud-Sign/)ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹è¿ä½œ

## âš  æ³¨æ„

- éšç¼˜ç»´æŠ¤ï¼Œä¸ä¿è¯ä¸ä¼šå°å·ï¼Œè¯·**ä¸è¦**ç”¨äºä¸»åŠ›è´¦å·ï¼ï¼ï¼

## flags

| flag                | default          | description                                                                                              |
| :------------------ | :--------------- | :------------------------------------------------------------------------------------------------------- |
| username            |                  | æ•°æ®åº“è´¦å·                                                                                               |
| pwd                 |                  | æ•°æ®åº“å¯†ç                                                                                                |
| ~~endpoint~~        | `127.0.0.1:3306` | æ•°æ®åº“ `host:port` ï¼ˆå·²åºŸå¼ƒï¼‰                                                                            |
| host                | `127.0.0.1:3306` | æ•°æ®åº“ `host:port`                                                                                       |
| db                  | `tbsign`         | æ•°æ®åº“åç§°                                                                                               |
| db_tls              | `false`          | CA è¯ä¹¦çš„é€‰é¡¹ï¼ˆä»…ç”¨äº MySQLï¼‰ï¼Œè¯·çœ‹ [CA è¯ä¹¦](#ca-è¯ä¹¦) éƒ¨åˆ†                                             |
| db_path             |                  | SQLite æ–‡ä»¶ç›®å½•                                                                                          |
| db_mode             | `mysql`          | ç”¨äºæ˜¾å¼æŒ‡å®šæ•°æ®åº“ç±»å‹ï¼Œåªç”¨äº PostgreSQL (ä»…å½“å€¼ä¸º `pgsql` æ—¶æœ‰æ•ˆï¼Œè¯·çœ‹ [PostgreSQL](#postgresql) éƒ¨åˆ†) |
| test                | `false`          | æµ‹è¯•æ¨¡å¼ï¼Œæ­¤æ¨¡å¼ä¸‹ä¸ä¼šè¿è¡Œè®¡åˆ’ä»»åŠ¡                                                                       |
| api                 | `false`          | æ˜¯å¦å¯åŠ¨ api                                                                                             |
| fe                  | `false`          | æ˜¯å¦å¯åŠ¨è‡ªå¸¦å‰ç«¯ï¼Œä»…å½“ `api` ä¸º `true` æ—¶å¯ä¸º `true`                                                     |
| address             | `:1323`          | åç«¯è¿è¡Œåœ°å€                                                                                             |
| setup               | `false`          | å¼ºåˆ¶å®‰è£…ç¨‹åºï¼ˆå¯èƒ½ä¼šè¦†ç›–ç°æœ‰é…ç½®ï¼‰                                                                       |
| auto_install        | `false`          | è‡ªåŠ¨å®‰è£…ï¼ˆä»…å½“æ•°æ®åº“ä¸å­˜åœ¨æ—¶å®‰è£…ï¼‰                                                                       |
| admin_name          |                  | ç®¡ç†å‘˜è´¦å·ï¼Œä»…å½“ `auto_install` ä¸º `true` æ—¶ä¼šç”¨åˆ°                                                       |
| admin_email         |                  | ç®¡ç†å‘˜é‚®ç®±ï¼Œä»…å½“ `auto_install` ä¸º `true` æ—¶ä¼šç”¨åˆ°                                                       |
| admin_password      |                  | ç®¡ç†å‘˜å¯†ç ï¼Œä»…å½“ `auto_install` ä¸º `true` æ—¶ä¼šç”¨åˆ°                                                       |
| no_proxy            | `false`          | å¿½ç•¥ç¯å¢ƒå˜é‡ä¸­çš„ä»£ç†é…ç½®                                                                                 |
| allow_backup        | `false`          | å…è®¸ç”¨æˆ·æ‰¹é‡å¯¼å‡º/å¯¼å…¥è´¦å·å’Œè´´å§åˆ—è¡¨ï¼Œå»ºè®®é˜…è¯» readme.md çš„ [å¤‡ä»½](#å¤‡ä»½) éƒ¨åˆ†                            |
| data_encrypt_key    |                  | åŠ å¯†éƒ¨åˆ†ç”¨æˆ·æ•°æ®çš„å¯†é’¥ï¼Œä½¿ç”¨ `base64url` æ ¼å¼å¡«å†™ï¼Œå»ºè®®é˜…è¯» readme.md çš„ [åŠ å¯†](#åŠ å¯†) éƒ¨åˆ†              |
| data_encrypt_action |                  | `encrypt` æˆ–è€… `decrypt`ï¼Œç”¨äºåŠ å¯†/è§£å¯†ç”¨æˆ·æ•°æ®ï¼Œå¤„ç†å®Œæˆåä¼šè‡ªåŠ¨é€€å‡ºï¼Œé»˜è®¤åº”å½“ç•™ç©º                      |
| dns_addr            |                  | æ‰‹åŠ¨è®¾ç½® DNS åœ°å€ï¼Œç‰¹æ®Šæƒ…å†µä¸‹ä½¿ç”¨ï¼Œé»˜è®¤åº”å½“ç•™ç©ºï¼Œå»ºè®®é˜…è¯» readme.md çš„ [ç½‘ç»œ](#ç½‘ç»œ) éƒ¨åˆ†                |

ç¤ºä¾‹

```shell
go run main.go --username=<dbUsername> --pwd=<DBPassword>
# or
./tbsign_go --username=<dbUsername> --pwd=<DBPassword>
# or https://github.com/cosmtrek/air
air -- --db_path=tbsign.db --test=true --api=true
```

## env

ä¸æ”¯æŒ `.env` æ–‡ä»¶ï¼Œè¯·ç›´æ¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨é¡ºåºæ˜¯ `flags` > `env` > `default`

| flag                | description                                                                                              |
| :------------------ | :------------------------------------------------------------------------------------------------------- |
| tc_username         | æ•°æ®åº“è´¦å·                                                                                               |
| tc_pwd              | æ•°æ®åº“å¯†ç                                                                                                |
| ~~tc_endpoint~~     | æ•°æ®åº“ `host:port` ï¼ˆå·²åºŸå¼ƒï¼‰                                                                            |
| tc_host             | æ•°æ®åº“ `host:port`                                                                                       |
| tc_db               | æ•°æ®åº“åç§°                                                                                               |
| tc_db_tls           | CA è¯ä¹¦çš„é€‰é¡¹ï¼ˆä»…ç”¨äº MySQLï¼‰ï¼Œè¯·çœ‹ [CA è¯ä¹¦](#ca-è¯ä¹¦) éƒ¨åˆ†                                             |
| tc_db_path          | SQLite æ–‡ä»¶ç›®å½•                                                                                          |
| tc_db_mode          | ç”¨äºæ˜¾å¼æŒ‡å®šæ•°æ®åº“ç±»å‹ï¼Œåªç”¨äº PostgreSQL (ä»…å½“å€¼ä¸º `pgsql` æ—¶æœ‰æ•ˆï¼Œè¯·çœ‹ [PostgreSQL](#postgresql) éƒ¨åˆ†) |
| tc_test             | æµ‹è¯•æ¨¡å¼ï¼Œæ­¤æ¨¡å¼ä¸‹ä¸ä¼šè¿è¡Œè®¡åˆ’ä»»åŠ¡                                                                       |
| tc_api              | æ˜¯å¦å¯åŠ¨åç«¯ api                                                                                         |
| tc_fe               | æ˜¯å¦å¯åŠ¨è‡ªå¸¦å‰ç«¯ï¼Œä»…å½“ `tc_api` ä¸º `true` æ—¶å¯ä¸º `true`                                                  |
| tc_address          | åç«¯è¿è¡Œåœ°å€                                                                                             |
| tc_auto_install     | è‡ªåŠ¨å®‰è£…ï¼ˆä»…å½“æ•°æ®åº“ä¸å­˜åœ¨æ—¶å®‰è£…ï¼‰                                                                       |
| tc_admin_name       | ç®¡ç†å‘˜è´¦å·ï¼Œä»…å½“ `tc_auto_install` ä¸º `true` æ—¶ä¼šç”¨åˆ°                                                    |
| tc_admin_email      | ç®¡ç†å‘˜é‚®ç®±ï¼Œä»…å½“ `tc_auto_install` ä¸º `true` æ—¶ä¼šç”¨åˆ°                                                    |
| tc_admin_password   | ç®¡ç†å‘˜å¯†ç ï¼Œä»…å½“ `tc_auto_install` ä¸º `true` æ—¶ä¼šç”¨åˆ°                                                    |
| tc_allow_backup     | å…è®¸ç”¨æˆ·æ‰¹é‡å¯¼å‡º/å¯¼å…¥è´¦å·å’Œè´´å§åˆ—è¡¨ï¼Œå»ºè®®é˜…è¯» readme.md çš„ [å¤‡ä»½](#å¤‡ä»½) éƒ¨åˆ†                            |
| tc_data_encrypt_key | åŠ å¯†éƒ¨åˆ†ç”¨æˆ·æ•°æ®çš„å¯†é’¥ï¼Œä½¿ç”¨ `base64url` æ ¼å¼å¡«å†™ï¼Œå»ºè®®é˜…è¯» readme.md çš„ [åŠ å¯†](#åŠ å¯†) éƒ¨åˆ†              |
| tc_dns_addr         | æ‰‹åŠ¨è®¾ç½® DNS åœ°å€ï¼Œç‰¹æ®Šæƒ…å†µä¸‹ä½¿ç”¨ï¼Œé»˜è®¤åº”å½“ç•™ç©ºï¼Œå»ºè®®é˜…è¯» readme.md çš„ [ç½‘ç»œ](#ç½‘ç»œ) éƒ¨åˆ†                |

## ç½‘ç»œ

- å†…åµŒç”± [curl](https://curl.se/docs/caextract.html) æä¾›çš„ Mozilla Root Storeï¼Œå½“ç³»ç»Ÿè¯ä¹¦åº“ä¸å¯ç”¨æ—¶ä¼šè°ƒç”¨
  - ä»“åº“è‡ªèº«ä¸å¸¦ CA åº“ï¼Œè¯·è‡ªè¡Œä¸‹è½½å¹¶æ”¾ç½®åœ¨ `assets/ca/cacert.pem`ï¼Œå‚è€ƒæŒ‡ä»¤ï¼š`curl -o assets/ca/cacert.pem https://curl.se/ca/cacert.pem`
- å¯ä»¥æ‰‹åŠ¨è®¾ç½® DNS æœåŠ¡å™¨åœ°å€ï¼Œæ”¯æŒçš„æ–‡æœ¬æ ¼å¼è¯·å‚è€ƒ <https://pkg.go.dev/net#Dial>ï¼Œç¤ºä¾‹ï¼š`8.8.8.8:53`

## æ•°æ®åº“

`db_mode`/`tc_db_mode` çš„å€¼ä¸º `pgsql` æ—¶é€‰æ‹© PostgreSQLï¼Œå¦åˆ™ï¼š

å½“ `db_path`/`tc_db_path` çš„å€¼ä¸ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå°±ä¼šä½¿ç”¨ SQLiteï¼›å¦åˆ™ä½¿ç”¨ MySQL

MySQL è¦æ±‚æ”¯æŒ [MySQL çª—å£å‡½æ•°](https://dev.mysql.com/doc/refman/8.0/en/window-functions.html)

- MySQL >= [8.0](https://dev.mysql.com/doc/refman/8.0/en/window-functions.html)
- MariaDB >= [10.2](https://mariadb.com/kb/en/changes-improvements-in-mariadb-10-2/)
- TiDB >= [3.0](https://docs.pingcap.com/tidb/stable/release-3.0-ga)

### CA è¯ä¹¦

ä»…é™ `MySQL`

æœ‰çš„äº‘æœåŠ¡ï¼Œè¦æ±‚ç”¨æˆ·ä½¿ç”¨ TLS è¿æ¥åˆ°å®ƒä»¬çš„æ•°æ®åº“ï¼›æœ‰çš„ç”¨æˆ·å¯¹å†…ç½‘ç¯å¢ƒæœ‰ç‰¹æ®Šçš„å®‰å…¨éœ€æ±‚ï¼Œæ­¤æ—¶å¯èƒ½éœ€è¦ç”¨åˆ°è¯ä¹¦æ–‡ä»¶

å¯ç”¨äº `db_tls` çš„å€¼åŒ…æ‹¬ `true`, `false`, `skip-verify`, `preferred` ä»¥åŠè¯ä¹¦æ–‡ä»¶çš„è·¯å¾„ï¼Œæ›´å¤šä¿¡æ¯è¯·å‚è€ƒ [go-sql-driver/mysql#tls](https://github.com/go-sql-driver/mysql?tab=readme-ov-file#tls)

ä¾‹å¦‚ä¸‹é¢çš„ç¬¬äºŒé¡¹æ˜¯ Debian/Ubuntu çš„ç›®å½•ï¼›å¦‚æœè¯ä¹¦å°šæœªè¢«å¯¼å…¥åˆ°ç³»ç»Ÿå¹¶ä¸”è½¯ä»¶å†…åµŒçš„ Mozilla Root Store ä¹Ÿä¸åŒ…å«è¯¥è¯ä¹¦ï¼Œéƒ¨ç½²æ—¶å¯èƒ½å°±éœ€è¦è¿™æ ·å¡«å†™è¯ä¹¦çš„å®é™…ç›®å½•

```shell
go run main.go --db_tls=true
# or...
go run main.go --db_tls=/etc/ssl/certs/ca-certificates.crt
```

### **PostgreSQL

æ”¯æŒ PostgreSQL æ˜¯å®éªŒæ€§çš„åŠŸèƒ½ï¼Œå¯èƒ½ä¼šè¢«ç æ‰ã€‚ä¸‹é¢æ˜¯ä¸€äº›æµ‹è¯•ç¯å¢ƒçš„ç»†èŠ‚

- å®‰è£…ç”¨çš„ `assets/sql/tc_pgsql.sql` ä½¿ç”¨ ChatGPT è½¬æ¢è‡ª `assets/sql/tc_sqlite.sql`ï¼Œç›®æµ‹æ²¡æœ‰å‡ºç°æ‰§è¡Œé”™è¯¯
- æµ‹è¯•æ•°æ®åº“ä½¿ç”¨ [Supabase](https://supabase.com/) çš„äº‘æ•°æ®åº“
- ç”±äºéœ€è¦å‘å‰å…¼å®¹ï¼Œ`db_mode` æ— æ³•ç”¨äºå¦å¤–ä¸¤ç±»æ•°æ®åº“
- å¼€å‘è€…å¯¹ PostgreSQL ä¸äº†è§£ï¼Œä»¥å‰ä»æœªä½¿ç”¨è¿‡ PostgreSQL

## å®‰è£…

- è¿ç§»æ³• (ä»… MySQL)
  - ç›´æ¥å®‰è£… [ç™¾åº¦è´´å§äº‘ç­¾åˆ°](https://github.com/MoeNetwork/Tieba-Cloud-Sign/)
  - ä½¿ç”¨åŸæ•°æ®åº“é…ç½®å¯åŠ¨
- å…¨æ–°å®‰è£… (MySQL, SQLite, PostgreSQL)
  - æ‰‹åŠ¨å®‰è£…
    - å¯åŠ¨ç¨‹åºï¼Œæ·»åŠ  `flag` `setup=true` (ç¤ºä¾‹: `./tbsign_go --db_path=tbsign.db --api=true --address=:8080 --setup=true`)
    - æ ¹æ®æ–‡å­—æç¤ºå®Œæˆè‡ªåŠ¨å®‰è£…æµç¨‹ï¼ˆä¸åŒæƒ…å†µä¸‹æ–‡å­—æç¤ºå¯èƒ½ä¼šç•¥æœ‰ä¸åŒï¼‰

      ```plaintext
      âœ  tbsign_go git:(master) âœ— ./tbsign_go --db_path=tbsign1.db --api=true --setup=true
      2024/06/29 18:18:47 tbsign: sqlite connected!
      ğŸ“Œç°åœ¨æ­£åœ¨å®‰è£… TbSignâ¡ï¸ï¼Œå¦‚æœæ•°æ®åº“å†…å«æœ‰æ•°æ®ï¼Œè¿™æ ·åšä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œè¯·æå‰åšå¥½å¤‡ä»½ã€‚
      å¦‚æœå·²ç»å®Œæˆå¤‡ä»½ï¼Œè¯·è¾“å…¥ä»¥ä¸‹éšæœºæ•°å­—å¹¶æŒ‰ä¸‹å›è½¦ï¼ˆæ˜¾ç¤ºä¸º "--> 1234 <--" ä»£è¡¨éœ€è¦è¾“å…¥ "1234"ï¼‰
      --> 428650691 <--
      è¯·è¾“å…¥: 428650691
      âŒ›æ­£åœ¨æ¸…ç†æ—§è¡¨
      âŒ›æ­£åœ¨å»ºç«‹æ•°æ®è¡¨å’Œç´¢å¼•
      âŒ›æ­£åœ¨å¯¼å…¥æ•°æ®...
      âŒ›å¯¼å…¥ç¬¬1é¡¹...
      âŒ›å¯¼å…¥ç¬¬2é¡¹...
      ğŸ”’æ³¨å†Œç®¡ç†å‘˜è´¦å·...
      ç®¡ç†å‘˜ç”¨æˆ·å: a
      ç®¡ç†å‘˜é‚®ç®±: a@a.a
      ç®¡ç†å‘˜å¯†ç  (æ³¨æ„ç©ºæ ¼): a
      âŒ›æ­£åœ¨æ³¨å†Œç®¡ç†å‘˜è´¦å·...
      ğŸ‰å®‰è£…æˆåŠŸï¼
      ```

    - \*(é€‰åš) ç™»å½•ç®¡ç†å‘˜è´¦å·ï¼Œæ‰“å¼€ **ç³»ç»Ÿç®¡ç†** å³å¯æ‰‹åŠ¨å¼€å¯è‡ªå¸¦æ’ä»¶
  - è‡ªåŠ¨å®‰è£…
    - å¯åŠ¨ç¨‹åºï¼Œæ·»åŠ  `flags` æˆ– ç¯å¢ƒå˜é‡ (ç¤ºä¾‹: `./tbsign_go --db=tbsign --username tcdb --pwd tcdb_password --api=true --address=:8080 --auto_install=true --admin_name=a --admin_email=a@a.a --admin_password=a`)

      - æ‹…å¿ƒ log æ³„éœ²ä¿¡æ¯çš„æ­¤æ—¶å¯ä»¥è®¾éšæœºå€¼ï¼Œç­‰åˆ°å®‰è£…å®Œæˆåå†ç™»å½•ä¿®æ”¹
      - é™¤éæ•°æ®åº“è¢«åˆ é™¤ï¼Œå¦åˆ™ ç”¨æˆ·å/é‚®ç®±/å¯†ç  ä»…åœ¨é¦–æ¬¡å¼€å¯æ—¶ä¼šç”¨åˆ°
    - \*(é€‰åš) ç™»å½•åå°ä¿®æ”¹ä¿¡æ¯ï¼Œå¼€å¯è‡ªå¸¦æ’ä»¶

\* æ³¨ï¼š`setup` å’Œ `auto_install` ä¸å¯åŒæ—¶ä¸º `true`

### å…¼å®¹æ€§

- [âš ï¸] é€šè¿‡ *è¿ç§»æ³•* å¯åŠ¨çš„ç¨‹åºèƒ½å¤Ÿä¸ [ç™¾åº¦è´´å§äº‘ç­¾åˆ°](https://github.com/MoeNetwork/Tieba-Cloud-Sign/) å…±å­˜ï¼Œä½†éƒ¨åˆ†æ’ä»¶æ²¡æœ‰å¯¹åº”çš„ PHP ç‰ˆæœ¬
- [âŒ] é€šè¿‡ *å…¨æ–°å®‰è£…* å¯åŠ¨çš„ç¨‹åºæ— æ³•å…¼å®¹ [ç™¾åº¦è´´å§äº‘ç­¾åˆ°](https://github.com/MoeNetwork/Tieba-Cloud-Sign/)ï¼Œå› ä¸ºç¼ºå°‘éƒ¨åˆ†æ•°æ®è¡¨å’Œè®¾ç½®é€‰é¡¹
- [âŒ] MySQL ä¸æ”¯æŒæ— æ³•ä½¿ç”¨ [MySQL çª—å£å‡½æ•°](https://dev.mysql.com/doc/refman/8.0/en/window-functions.html) çš„å‘è¡Œç‰ˆï¼Œä½¿ç”¨äº†**ä¸æ”¯æŒ**çš„å‡½æ•° `ROW_NUMBER()`
- [âš ï¸] å¼€å‘ç¯å¢ƒä½¿ç”¨çš„ MySQL ç‰ˆæœ¬å·ä¸º `8.0` æˆ–æ›´é«˜ï¼Œå…¶ä»– MySQL å‘è¡Œç‰ˆè¯·è‡ªè¡Œæµ‹è¯•æ˜¯å¦å¯ç”¨
- [âŒ] PostgreSQL ä¸ä¿è¯å¯ç”¨ï¼Œå¯èƒ½ä¼šè¢«ç æ‰ï¼Œä¹Ÿä¸ä¼šä¸“é—¨åšæµ‹è¯•
- [âš ï¸] xgo é•œåƒä½¿ç”¨çš„ tag ä¸º `go-1.24.2`ï¼Œå¯èƒ½ä¼šæœ‰æ“ä½œç³»ç»Ÿä¸å†å—åˆ°æ”¯æŒï¼ˆå¦‚ Windows 7ï¼‰

## å‰ç«¯

â¡ï¸ <https://github.com/BANKA2017/tbsign_go_fe>

### åµŒå…¥å¼å‰ç«¯

æ­¤ç±»éƒ¨ç½²éœ€è¦ç”¨åˆ°å…¶ä»–ä»“åº“ï¼Œå¹¶ä¸”éœ€è¦æ‰‹åŠ¨æˆ–è‡ªåŠ¨æ·»åŠ æ–‡ä»¶ï¼Œå¦‚æœä¸çŸ¥é“æ˜¯æ€ä¹ˆå›äº‹ï¼Œè¯·å¿½ç•¥æœ¬èŠ‚ï¼Œä½¿ç”¨å‰ååˆ†ç¦»éƒ¨ç½²ï¼Œæˆ–ç›´æ¥ä½¿ç”¨ build.sh æ‰“åŒ…

- ä½¿ç”¨åµŒå…¥å¼å‰ç«¯å‰ï¼Œè¯·è®¾ç½®ç¯å¢ƒå˜é‡

  ```env
  NUXT_BASE_PATH="/api"
  ```

- åœ¨å‰ç«¯ä»“åº“çš„ç›®å½•æ‰§è¡Œ `yarn run generate` åå°† `/dist` ç›®å½•æ•´ä¸ªæ‹·è´åˆ° `/assets` å†…ï¼ˆå³ `/assets/dist`ï¼‰
- ç…§å¸¸ `go build`

åµŒå…¥å¼å‰ç«¯å¯ç”¨åï¼ŒAPI è·¯å¾„è‡ªåŠ¨æ·»åŠ å‰ç¼€ `/api`ï¼ŒåŒæ—¶ response header ä¸å†å«æœ‰ `Access-Control-Allow-Origin`

## API (WIP)

ä»…ä¾›å‚è€ƒï¼Œæœªæ¥å¯èƒ½è¿˜ä¼šä¿®æ”¹ï¼Œç­‰åˆ°ç¨³å®šåéšç¼˜å‡ºæ–‡æ¡£

## æ’ä»¶

å¤–é“¾ä¸ºå¯¹åº” PHP ç‰ˆæ’ä»¶

- [x] [è‡ªåŠ¨åˆ·æ–°è´´å§åˆ—è¡¨](https://github.com/MoeNetwork/Tieba-Cloud-Sign/tree/master/plugins/ver4_ref)
- [x] [åäººå ‚](https://github.com/MoeNetwork/Tieba-Cloud-Sign/tree/master/plugins/ver4_rank)
- [x] [å¾ªç¯å°ç¦](https://github.com/MoeNetwork/Tieba-Cloud-Sign/tree/master/plugins/ver4_ban)
- [x] ç”¨æˆ·æˆé•¿ä»»åŠ¡
- [x] [çŸ¥é“å•†åŸæŠ½å¥–](https://github.com/96dl/Tieba-Cloud-Sign-Plugins/blob/master/ver4_lottery/ver4_lottery_desc.php)
- [x] âš ï¸æ–‡åº“ä»»åŠ¡ï¼Œ*ä½¿ç”¨æ­¤æ’ä»¶å¯èƒ½ä¼šå¯¼è‡´æ–‡åº“ç­¾åˆ°åŠŸèƒ½è¢«å°ç¦ï¼Œå°ç¦ç†ç”±ä¸ºï¼š**æ‚¨çš„è´¦å·å› æ¶‰å«Œåˆ·åˆ†ä½œå¼Šè€Œè¢«å°ç¦ï¼Œä¸èƒ½è¿›è¡Œæ­¤é¡¹æ“ä½œ***
- [x] å§ä¸»è€ƒæ ¸

### æ’ä»¶å¼€å‘

âš  æ’ä»¶è¿˜æ— æ³•åšåˆ°å¼€ç®±å³ç”¨ï¼Œä½¿ç”¨å‰éœ€è¦é€šè¿‡æºç ç¼–è¯‘

ç›®å‰æ’ä»¶å¼€å‘è‡³å°‘éœ€è¦åˆ†åˆ«å‡†å¤‡ä¸€ä¸ªå‰ç«¯(.vue)å’Œåç«¯çš„æ–‡ä»¶(.go)ï¼Œé…ç½®æ–¹é¢å¯èƒ½ä¼šæ¯”è¾ƒéº»çƒ¦

- æ’ä»¶ç›®å½• `/plugins` æ”¾ä¸‹æ ¸å¿ƒæ–‡ä»¶ï¼Œè¿™äº›å‰ç¼€åªæ˜¯ä¸ºäº†ä¾¿äºç®¡ç†ï¼Œgolang ä¸­åŒä¸€å±‚çš„ééšè—æ–‡ä»¶å‘½åå¯¹ç¼–è¯‘æ— å½±å“
  - æ ‡å‡†æ’ä»¶
    - æ–‡ä»¶å‘½ååº”å½“ä½¿ç”¨å‰ç¼€ `s_`(standard)ï¼Œæ’ä»¶æœ¬èº«çš„å‘½åå»ºè®®ä½¿ç”¨ `<namespace>_<plugin_name>` æ¥é¿å…å†²çªï¼Œä½† `namespace` ä¸ºéå¼ºåˆ¶é¡¹ï¼Œå®é™…å‘½åè¯·å°½é‡è´´è¿‘æ’ä»¶åŠŸèƒ½
      - å‘½åå»ºè®®ä½¿ç”¨ **è‹±è¯­å•è¯/å¸¸ç”¨ç¼©å†™**ï¼Œæˆ–è€…ä¸ **å®Œæ•´æ‹¼éŸ³** çš„ç»„åˆã€‚è¯·ä¸è¦ç”¨æ‹¼éŸ³é¦–å­—æ¯ç¼©å†™
    - å¯¼å‡º API æ¥å£çš„æ–¹å¼è¯·å‚è€ƒç°æœ‰çš„æ’ä»¶
      - å¯¼å‡ºè·¯ç”±çš„è·¯å¾„ä¸º `[/api]/plugins/<PluginInfo.Name>/<PluginInfo.Endpoints.Path>`ï¼Œæœ‰æ²¡æœ‰ `/api` å‰ç¼€å–å†³äºæ˜¯å¦å¯ç”¨è‡ªå¸¦å‰ç«¯
    - å…¶ä»–æ­¥éª¤è¯·å‚è€ƒå‡ ä¸ªè‡ªå¸¦çš„æ ‡å‡†æ’ä»¶ï¼Œå¿…è¦çš„å‡½æ•°å’Œå˜é‡é…ç½®è¯·å‚è€ƒ [æ ‡å‡†æ’ä»¶æ¨¡æ¿](https://github.com/BANKA2017/tbsign_go/blob/master/plugins/_s_example.go)
  - å‡çº§æ’ä»¶
    - æ–‡ä»¶å‘½ååº”å½“ä½¿ç”¨å‰ç¼€ `u_`(upgrade)ï¼Œç”¨äºä¸å…¼å®¹æ›´æ–°ï¼Œä½†ç›®å‰è¿˜ä¸å­˜åœ¨éœ€è¦ç”¨åˆ°çš„åœºæ™¯ï¼Œæ‰€ä»¥æš‚æ—¶æ— éœ€ç†ä¼šï¼ˆç”šè‡³æ ¹æœ¬æ²¡æœ‰å†™è°ƒç”¨é€»è¾‘ï¼‰
  - æ ¸å¿ƒæ’ä»¶
    - æ–‡ä»¶å‘½ååº”å½“ä½¿ç”¨å‰ç¼€ `c_`(core)
- å‰ç«¯
  - å¯¹åº”æ’ä»¶çš„é¡µé¢
    - åœ¨ç›®å½• `pages/` æ·»åŠ å¯¹åº”æ’ä»¶çš„é¡µé¢ vue æ–‡ä»¶ï¼Œæ–‡ä»¶åå¿…é¡»å¸¦æœ‰å‰ç¼€ `plugin_`
  - *å¦‚æœå¯¹å˜é‡è®¾ç½®è¡¨å•æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œè¿˜éœ€è¦ä¿®æ”¹ `system_admin.vue` çš„å†…å®¹
    - å«æœ‰ç‰¹æ®Šåç¼€ `_action_limit` çš„å˜é‡å°†ä¼šåœ¨å‰ç«¯è‡ªåŠ¨è¯†åˆ«æˆä¸å°äº `0` çš„ `number` ç±»å‹
    - å…¶ä»–å˜é‡è¯†åˆ«æˆ `text`
- *æ•°æ®åº“ model
  - ç®€å•çš„ä¿¡æ¯å¯ä»¥ç›´æ¥å­˜åœ¨è¡¨ `tc_options`ï¼ˆå…¨å±€ï¼‰ æˆ– `tc_users_options`ï¼ˆç”¨æˆ·ï¼‰ ä¸­
  - å¦‚æœéœ€è¦ä½¿ç”¨æ•°æ®åº“å­˜å‚¨æ’ä»¶ä¿¡æ¯
    - è¯·å‡†å¤‡å¥½è¡¨æ¨¡å‹å¹¶å­˜æ”¾åœ¨ `model/`ï¼ŒåŒ…åä¸º `model`
    - æˆ–è€…ç”Ÿæˆå¥½è¡¨æ¨¡å‹åå°†ç›¸å…³å†…å®¹æ‹·è´åˆ°æ’ä»¶çš„ go æ–‡ä»¶å†…ï¼ŒåŒ…åä¸º `_plugin`

    å‚è€ƒ codegen å‘½ä»¤ä¸º

    ```shell
    /root/go/bin/gentool -dsn "..." -modelPkgName "model" -onlyModel
    ```

    å°½ç®¡ Gorm å¯ä»¥æ‰‹æ“ raw SQLï¼Œä½†æˆ‘ä»¬å¹¶ä¸å»ºè®®è¿™æ ·åš

- *protobuf
  - éƒ¨åˆ†è¯·æ±‚å¯èƒ½éœ€è¦ç”¨åˆ° protobufï¼Œè¿™éƒ¨åˆ†è¿˜æ²¡å®Œå–„ï¼Œæ•¬è¯·æœŸå¾…

æ ‡å‡†æ’ä»¶ä¸å†ä¸æ ¸å¿ƒå¼ºç»‘å®šï¼Œä½¿ç”¨ [SemVer](https://semver.org/lang/zh-CN/)ï¼Œä½†æ–°æ’ä»¶ä½¿ç”¨çš„ä¸€äº›æ–°ç‰ˆæ ¸å¿ƒå‡½æ•°å¯èƒ½ä¼šå¯¼è‡´æ— æ³•åœ¨æ—§ç‰ˆæ ¸å¿ƒä¸­ä½¿ç”¨

*å…³äºæ’ä»¶å¼€å‘é…ç½®ä¸Šè¶Šæ¥è¶Šå¤æ‚çš„åæ§½ï¼šä¸ºäº†é€ƒç¦»é…ç½®åœ°ç‹±è€Œäº²æ‰‹åˆ›é€ äº†ä¸€ä¸ªé…ç½®åœ°ç‹±ï¼Œä¹Ÿæ˜¯å¾ˆè®½åˆºäº†

## ç¼–è¯‘

### CGO

> go-sqlite3 is cgo package. If you want to build your app using go-sqlite3, you need gcc. However, after you have built and installed go-sqlite3 with `go install github.com/mattn/go-sqlite3` (which requires gcc), you can build your app without relying on gcc in future.

å¦‚æœ‰é™æ€ç¼–è¯‘çš„éœ€æ±‚ï¼ˆå¦‚ä¸‹æ–‡çš„ Docker ä½¿ç”¨ Alpine é»˜è®¤ä¸ä½¿ç”¨ glibcï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ `musl-gcc`ï¼Œå‚è€ƒå‘½ä»¤

```bash
# apt install -y musl-dev

CGO_ENABLED=1 CC=musl-gcc go build -ldflags "-linkmode external -extldflags -static" -tags netgo

# æˆ–è€… docker ä¸€æ­¥åˆ°ä½
docker run --rm -v $(pwd):/app/tbsign -e EXTERNAL_LDFLAGS="-linkmode external -extldflags -static" -w /app/tbsign alpine:3 sh -c "apk add --no-cache --upgrade nodejs npm go git gcc musl-dev && npm install -g corepack && corepack enable && chmod +x build.sh && sh ./build.sh"

# root@rpi4:~# ldd tbsign_go
# not a dynamic executable
```

### build.sh

ç®€å•å†™äº†ä¸ªç¼–è¯‘è„šæœ¬ï¼Œå­˜æ”¾åœ¨ `~/build.sh`

### Docker

â¡ï¸ [ghcr.io/banka2017/tbsign_go](https://github.com/BANKA2017/tbsign_go/pkgs/container/tbsign_go)

- Dockerfile åœ¨ `~/docker`ï¼Œå®˜æ–¹å‘å¸ƒçš„é•œåƒåªä¼šæ”¯æŒ `linux/arm64` å’Œ `linux/amd64`
- docker-compose.yml æ–‡ä»¶ä½äº `~/docker/docker-compose.yml`

Docker ç‰ˆä¸æ”¯æŒåœ¨è®¾ç½®é¡µé¢ä¸‹è½½æ›´æ–°

å‚è€ƒå¯åŠ¨å‘½ä»¤

```bash
docker run -d --restart unless-stopped -v ./db:/app/tbsign/db -p 8080:1323 ghcr.io/banka2017/tbsign_go:master
```

- é»˜è®¤æ•°æ®åº“ç›®å½•åœ¨ `/app/tbsign/db/tbsign_go.db`ï¼Œ
  - å¦‚æœä½¿ç”¨ `SQLite` å»ºè®®å°† `/app/tbsign/db` æ˜ å°„åˆ°å®¿ä¸»æœº
  - å¦‚æœä½¿ç”¨ `MySQL` æˆ– `PostgreSQL` è¯·æ‰‹åŠ¨å°†ç¯å¢ƒå˜é‡ `tc_db_path` çš„å€¼è®¾ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œè¦†ç›–åŸé•œåƒçš„é»˜è®¤å€¼
- å¼€æ”¾ç«¯å£å·ä¸º `1323`

### ç‰ˆæœ¬å·

æ ¼å¼ä¸º `tbsign_go.<YYYYMMDD>.<BACKEND_COMMIT_HASH[0:7]>.<FRONTEND_COMMIT_HASH[0:7]>.<OS>-<ARCH>` ï¼Œå¦‚æœæ˜¯ç”¨äº Windows ç³»ç»Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶è¿˜ä¼šæœ‰ `.exe` æ‹“å±•å

å®˜æ–¹æä¾›çš„å¯æ‰§è¡Œæ–‡ä»¶åŒ…å« linux/amd64, linux/arm64, windows/amd64, darwin/amd64, darwin/arm64 äº”ä¸ªç‰ˆæœ¬ï¼Œä½¿ç”¨ [xgo](https://github.com/techknowlogick/xgo) è¿›è¡Œäº¤å‰ç¼–è¯‘ï¼Œæ‰‹åŠ¨è§¦å‘ç¼–è¯‘çš„ Actions ä»»åŠ¡

\* ç”±äºæ·»åŠ  `musl-libc` é™æ€ç¼–è¯‘äº§ç‰©æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥ä¸ä¼šå‘å¸ƒ `musl` ç‰ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚æœ‰éœ€è¦å¯ä»¥è§£åŒ… Docker é•œåƒ

å…¶å®ƒç³»ç»Ÿè¯·è‡ªè¡Œç¼–è¯‘è¿è¡Œ

## æ›´æ–°

### å‘å¸ƒç±»å‹

ç”± `share.BuildPublishType` çš„å€¼å†³å®šï¼Œå…·ä½“æƒ…å†µå¦‚ä¸‹è¡¨

| ç±»å‹         | å‘å¸ƒæ–¹å¼                                                                             | æ”¯æŒæ›´æ–°è‡ªèº«æ–‡ä»¶ |
| :----------- | :----------------------------------------------------------------------------------- | :--------------- |
| `source`     | é€šè¿‡æºç ç›´æ¥ç¼–è¯‘çš„é»˜è®¤å€¼                                                             | âŒ                |
| `binary`     | é€šè¿‡ [GitHub Releases](https://github.com/BANKA2017/tbsign_go/releases) å‘å¸ƒ         | âœ…                |
| `docker`     | é€šè¿‡ [ghcr.io](https://github.com/BANKA2017/tbsign_go/pkgs/container/tbsign_go) å‘å¸ƒ | âŒ                |
| å…¶ä»–è‡ªå®šä¹‰å€¼ | ç”±ç¬¬ä¸‰æ–¹æ‰“åŒ…è€…è‡ªè¡Œå†³å®š                                                               | âš ï¸ ç”±æ‰“åŒ…è€…å†³å®š   |

### å‘å¸ƒåœ°å€

ç”± `_function.ReleaseFilesPath` å†³å®šï¼Œç¬¬ä¸‰æ–¹æ‰“åŒ…è€…å¯ä»¥è‡ªè¡Œä¿®æ”¹

## å¤‡ä»½

ä» [tbsign_go.20241203.f7b5434.881b23b](https://github.com/BANKA2017/tbsign_go/tree/tbsign_go.20241203.f7b5434.881b23b) ç‰ˆæœ¬èµ·ï¼Œæ”¯æŒç”¨æˆ·å¯¼å‡º/å¯¼å…¥éƒ¨åˆ†è´¦å·æ•°æ®ã€‚

æ­¤å‰ï¼Œtbsign_go è®¾è®¡ä¸Šä¸å…è®¸ API è¿”å› `bduss` å’Œ `stoken`ï¼Œåªèƒ½é€šè¿‡æŸ¥çœ‹æ•°æ®åº“è·å–ï¼Œç¡®ä¿å³ä½¿ç«™ç‚¹è´¦å·è¢«ç›—ï¼Œä»æ— æ³•ä» tbsign_go å¯¼å‡ºæ•æ„Ÿæ•°æ®ã€‚æ­¤ç‰ˆæœ¬åï¼Œè‹¥ç«™ç‚¹å¼€æ”¾å¤‡ä»½åŠŸèƒ½ï¼Œç”¨æˆ·ç™»å½•åå¯é€šè¿‡è´¦å·å¯†ç å¯¼å‡ºè¿™äº›æ•°æ®ã€‚

ä¸ºå¹³è¡¡**å®‰å…¨**ä¸**ä¾¿åˆ©**ï¼Œç³»ç»Ÿè®¾ç½®é¡µé¢ï¼ˆç½‘é¡µï¼‰æ–°å¢äº†å¤‡ä»½åŠŸèƒ½å¼€å…³ï¼Œå¹¶æ·»åŠ äº†å¯åŠ¨æ—¶ç¡®å®šæ˜¯å¦å¯ç”¨çš„æ€»å¼€å…³ï¼ˆcliï¼‰ã€‚æœªå¯ç”¨çš„ç«™ç‚¹å°†ç¦ç”¨ç›¸å…³ APIï¼Œæ˜¯å¦å¼€å¯åŠŸèƒ½ç”±ç«™ç‚¹ç®¡ç†å‘˜è‡ªè¡Œå†³å®šã€‚

### æ ¼å¼

å¯¼å‡ºæ ¼å¼ä¸å¯¹åº”æ•°æ®è¡¨ä¸€è‡´ï¼Œå¯é€šè¿‡ç¼–è¾‘æ–‡ä»¶å®ç°æ‰¹é‡å¯¼å…¥è´¦å·

```json
{
  "tc_baiduid": [
    {
      "id": 1,
      "bduss": "",
      "stoken": "",
      "portrait": "tb.1.xxx.xxxx",

      "name": ""
    }
  ],
  "tc_tieba": [
    {
      "pid": 1,
      "fid": 29,
      "tieba": "å°è¯´",

      "no": false,
      "status": 0,
      "latest": 3,
      "last_error": "NULL"
    }
  ]
}
```

- `tc_baiduid.id` çš„å€¼æœªå¿…ç­‰äºæœ€ç»ˆè¯¥è´¦å·çš„ `pid`ï¼Œæ­¤å€¼ä»…ç”¨äºæ˜ å°„ `tc_tieba.pid`
- `tc_tieba.pid` å¿…é¡»è¦æœ‰å¯¹åº”çš„ `tc_baiduid.id` å€¼
- `tc_baiduid.name`ã€`tc_tieba.no`ã€`tc_tieba.status`ã€`tc_tieba.latest`ã€`tc_tieba.last_error` å¯ä»¥æ²¡æœ‰å€¼ï¼Œä½†å»ºè®®åŠ ä¸Š
  - `name` æ˜¯ç”¨æˆ·åï¼Œæœ‰äº›åæœŸé€šè¿‡æ‰‹æœºæ³¨å†Œçš„ç”¨æˆ·å¯èƒ½æ²¡æœ‰ç”¨æˆ·å
  - `no` ç”¨äºè¡¨ç¤ºæ˜¯å¦**å¿½ç•¥**ç­¾åˆ°
  - `status` å’Œ `last_error` ç”¨äºè¡¨ç¤ºä¸Šä¸€æ¬¡ç­¾åˆ°çš„æƒ…å†µ
  - `latest` è¡¨ç¤ºæœ€åç­¾åˆ°çš„æ—¥æœŸï¼Œæ¯æœˆç¬¬ä¸€å¤©æ˜¯ `1`

## *åŠ å¯†

æ”¯æŒ æ•°æ®åŠ å¯† æ˜¯å®éªŒæ€§çš„åŠŸèƒ½ï¼Œä¸ä¼šè¢«ç æ‰ï¼Œä½†å‰æœŸå¯èƒ½ä¼šæœ‰ä¸¥é‡çš„ bug å’Œæ¼æ´ï¼Œä»…ä¾›å°é²œ

ä¸ºäº†ä¿æŠ¤ç”¨æˆ·æ•°æ®ï¼Œæ”¯æŒä½¿ç”¨ `aes-256-gcm` åŠ å¯†éƒ¨åˆ†ç”¨æˆ·æ•°æ®ï¼Œç›®å‰å·²ç»æ”¯æŒ

- [x] BDUSS
- [x] Stoken
- [x] Bark key
- [x] Ntfy topic
- [x] PushDeer key

åŠ å¯†åçš„æ•°æ®æ ¼å¼å‰ 12 ä½ä¸º `iv`ï¼Œå…¶ä½™éƒ¨åˆ†ä¸ºå¯†æ–‡

è¯·åœ¨åŠ è§£å¯†æ•°æ®å‰å¤‡ä»½æ•°æ®åº“ï¼Œä»¥å…å‘ç”Ÿæ„å¤–

æœªæ¥å¯èƒ½ä¼šæ”¯æŒåŠ å¯†æ›´å¤šçš„æ•°æ®ï¼Œå‡çº§å‰éœ€è¦å…ˆå°†æ•°æ®è§£å¯†ï¼Œé¿å…å‡ºé”™ï¼Œå‡çº§å®Œæˆåé‡æ–°åŠ å¯†

## *æ¯æ—¥ç­¾åˆ°æŠ¥å‘Š

æ¯æ—¥æŠ¥å‘Š æ˜¯å®éªŒæ€§çš„åŠŸèƒ½ï¼Œå¯èƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨

åœ¨æŒ‡å®šæ—¶é—´ä»¥åæ£€æŸ¥å„ä¸ªè´¦å·çš„ç­¾åˆ°æƒ…å†µï¼Œå¹¶ä¸”å‘é€åˆ°å¼€å¯æŠ¥å‘Šçš„ç”¨æˆ·çš„é»˜è®¤æ¨é€æ¸ é“

ç›®å‰æ”¯æŒæ¨é€çš„ä¿¡æ¯åŒ…æ‹¬ï¼š

- [x] å„ä¸ªè´´å§è´¦å·çš„ æˆåŠŸ/å¤±è´¥/å¾…ç­¾/å¿½ç•¥ æ•°é‡
- [x] å„ä¸ªè´´å§è´¦å·çš„ BDUSS æœ‰æ•ˆæ€§

ç›®å‰æœ‰ä¸€äº›å€¼æ˜¯ç¡¬ç¼–ç åˆ°è½¯ä»¶çš„ï¼ŒåŒ…æ‹¬ï¼š

- å•æ¬¡æ£€æŸ¥ç”¨æˆ·æ•°ï¼š`100`ï¼Œæ¯åˆ†é’Ÿæ£€æŸ¥ 100 ä¸ªç«™ç‚¹è´¦å·ï¼Œä¸€ä¸ªç«™ç‚¹è´¦å·å¯èƒ½ä¼šæœ‰å¤šä¸ªè´´å§è´¦å·ï¼Œæ­¤æ—¶ä¼šä¸€æ¬¡æ€§å¯¼å‡ºï¼Œæ‰€ä»¥ä¼šæœ‰å¡é¡¿å´©æºƒçš„å¯èƒ½æ€§
- ~~è´¦å· BDUSS æ— æ•ˆé˜ˆå€¼ï¼š`0.95`ï¼Œç”±äºé”™è¯¯ä»£ç  `1` å­˜åœ¨è¯¯æŠ¥çš„å¯èƒ½ï¼Œæ‰€ä»¥éœ€è¦å‡ºé”™è´´å§æ•°é‡è¾¾åˆ°æ€»è´´å§æ•°é‡çš„ `95%` æ‰ä¼šåˆ¤æ–­ä¸º BDUSS å¤±æ•ˆã€‚ä½†åœ¨æç«¯æƒ…æ™¯ï¼ˆå¦‚åªå…³æ³¨äº†ä¸€ä¸ªè´´å§ï¼Œè¿™ä¸ªè´´å§ç­¾åˆ°å¤±è´¥å¾—åˆ°é”™è¯¯ä»£ç  `1`ï¼Œæ­¤æ—¶å¤±è´¥ç‡ `100%`ï¼‰ä»å­˜åœ¨è¯¯æŠ¥çš„å¯èƒ½æ€§~~
  - ç›®å‰ä½¿ç”¨å½“å¤©çš„ç­¾åˆ°è®°å½•ä¸­æœ‰æ—  `110000` æ¥åˆ¤æ–­æ˜¯å¦ç™»å‡º

## é‡ç­¾

é‡ç­¾ä½¿ç”¨ [æˆªæ–­äºŒè¿›åˆ¶æŒ‡æ•°é€€é¿](https://en.wikipedia.org/wiki/Exponential_backoff)ï¼Œé»˜è®¤æœ€å¤§é€€é¿é—´éš”ä¸º 1 åˆ†é’Ÿï¼ˆè·ŸåŸç‰ˆä¸€æ ·ï¼‰

å¯ä»¥é€šè¿‡ä¿®æ”¹ `go_recheck_in_max_interval`ï¼ˆç³»ç»Ÿç®¡ç† -> ç­¾åˆ° -> æœ€å¤§é‡ç­¾é—´éš” (åˆ†é’Ÿ)ï¼‰è°ƒæ•´é—´éš”ï¼Œæœ€å°é—´éš”ä¸º 1 åˆ†é’Ÿï¼Œå¦‚æœé—´éš”è®¾ç½®å¾—è¿‡å¤§å¯èƒ½ä¼šå¯¼è‡´æç«¯æƒ…å†µä¸‹æ— æ³•å®Œæˆå…¨éƒ¨é‡ç­¾ä»»åŠ¡

## å·²çŸ¥é—®é¢˜

- [x] ä¸æ”¯æŒé™åˆ¶å•æ¬¡ç­¾åˆ°è´´å§æ€»æ•°ï¼Œä¼šä¸€æ¬¡æ€§å…¨éƒ¨ç­¾å®Œ
- [x] æ²¡æœ‰çµæ´»çš„è¯·æ±‚é—´éš”å’Œè¯·æ±‚å¤´æ¨¡æ‹Ÿï¼Œæœ‰å°å·çš„é£é™©
- [x] åªæœ‰ç­¾åˆ°è¿™ä¸€ä¸ªåŠŸèƒ½ï¼Œå¯¹é‡ç­¾çš„å¤„ç†çº¦ç­‰äºæ²¡æœ‰
- [ ] æ··ä¹±çš„è¾“å‡ºï¼Œéšå¤„å¯è§çš„æ‰“ç‚¹
- [ ] æ²¡æœ‰è¿›è¡Œä»»ä½•ä¼˜åŒ–
- [x] ä¸€æ¬¡æ€§æ‰§è¡Œï¼Œä»ç„¶éœ€è¦ cron
- [x] ä¼šè¿è¡Œæœªå®‰è£…/æœªæ¿€æ´»çš„æ’ä»¶
- [ ] é‚€è¯·ç ç³»ç»Ÿåœ¨è€ƒè™‘è¦ä¸è¦åšï¼Œå¦‚æœä¸æƒ³åšå°±ä¼šç§»å…¥**ä¸ä¼šè§£å†³åˆ—è¡¨**
- [x] é‚®ç®±ç›¸å…³â€¦â€¦é‚®ç®±æ‰¾å›âœ…
- [x] ~~ç­¾å‘ç”¨æˆ· JWT çš„å¯†é’¥ä»…å­˜åœ¨äºå†…å­˜ä¸­ï¼Œç³»ç»Ÿé‡å¯åä¼šæ‰ç™»å½•~~ ~~ç‰¹æ€§ï¼éƒ½æ˜¯ç‰¹æ€§ï¼~~ ä¸å†ä½¿ç”¨ JWT

**ä¸‹é¢æåˆ°çš„ä¸ä¼šè§£å†³**

- å…¼å®¹æ€§
  - [x] ä¸ä¼šå¯¹æ‰€è°“çš„ vip è´¦å·æœ‰ä»»ä½•ç‰¹æ®Šç…§é¡¾ï¼ŒåŸ vip è´¦å·çš„ç‰¹æƒä¹Ÿä¼šä¸‹æ”¾ç»™æ‰€æœ‰è´¦å·
  - [x] æ— æ³•æ”¯æŒä¸€ä¸ªè´´å§è´¦å·ç»‘å®šåˆ°å¤šä¸ªäº‘ç­¾è´¦å·
  - [x] ä¸åŒè¯­è¨€å„æœ‰ç‰¹æ€§ï¼Œä¸ä¼šå¼ºæ±‚ 1:1 å…¼å®¹
  - [x] ä¸æ”¯æŒè‡ªå®šä¹‰çš„æ•°æ®è¡¨å‰ç¼€ï¼Œç»Ÿä¸€ä½¿ç”¨é»˜è®¤å‰ç¼€ `tc_`
  - [x] ä¸æ”¯æŒåˆ†è¡¨
  - [x] ç™»å½•/æ³¨å†Œä¸ä¼šæœ‰éªŒè¯ç 
- æ¥å£
  - [x] å¾ªç¯å°ç¦æ— æ³•ç¡®è®¤å°ç¦æ˜¯å¦æˆåŠŸï¼Œå› ä¸ºè¿”å›çš„ç»“æœæ˜¯ä¸€æ ·çš„
  - [x] æ‰§è¡Œæˆé•¿ä»»åŠ¡æ—¶æ— æ³•ç¡®è®¤æ˜¯å¦é‡å¤æ‰§è¡Œï¼ŒåŸå› åŒä¸Š

## TODO

\* å¸¦ `?` å¼€å¤´çš„è¡¨ç¤ºæœ‰è€ƒè™‘ï¼Œä½†å¯èƒ½æ°¸è¿œä¸åš

- [ ] è§£å†³å·²çŸ¥é—®é¢˜
- [x] å…¼å®¹éƒ¨åˆ†åŸç‰ˆæ’ä»¶
  - [x] [è‡ªåŠ¨åˆ·æ–°è´´å§åˆ—è¡¨](https://github.com/MoeNetwork/Tieba-Cloud-Sign/tree/master/plugins/ver4_ref)
  - [x] [åäººå ‚](https://github.com/MoeNetwork/Tieba-Cloud-Sign/tree/master/plugins/ver4_rank)
  - [x] [å¾ªç¯å°ç¦](https://github.com/MoeNetwork/Tieba-Cloud-Sign/tree/master/plugins/ver4_ban)
  - [x] ~~[åˆ è´´æœº](https://github.com/MoeNetwork/Tieba-Cloud-Sign/tree/master/plugins/ver4_review)ï¼ˆå¯èƒ½ä¼šæ‹–å¾ˆä¹…ç”šè‡³ä¸ä¼šåšï¼‰~~ ä¸å†è€ƒè™‘è·Ÿè¿›åˆ è´´æœºï¼Œæœ‰éœ€è¦çš„è¯·é€‰æ‹©å…¶ä»–è´´å§ç®¡ç†è½¯ä»¶
  - [x] ?[çŸ¥é“å•†åŸæŠ½å¥–](https://github.com/96dl/Tieba-Cloud-Sign-Plugins/blob/master/ver4_lottery/ver4_lottery_desc.php)
- [ ] ä¼˜åŒ– PHP åŸç‰ˆçš„ç›¸å…³åŠŸèƒ½
- [x] ä¸å†è€ƒè™‘ ~~é€šè¿‡è¯»å– `config.php` å–å¾—æ•°æ®åº“è¿æ¥ä¿¡æ¯~~
- [x] è‡ªåŠ¨æ¸…ç†è§£é™¤ç»‘å®šçš„è´¦å·çš„æ’ä»¶è®¾ç½®
- [x] ?æ‰“åŒ…/Docker/æˆ–è€…åˆ«çš„
- [x] ?è‡ªåŠ¨åŒ–éƒ¨ç½²
- [ ] ?æ”¯æŒæ›´å¤š Gorm ä¹Ÿæ”¯æŒçš„æ•°æ®åº“
- [x] ?é‚®ç®±ä»¥å¤–çš„æ¨é€æ–¹å¼
- [ ] å®Œå–„æƒé™æ§åˆ¶
- [x] ä¸ªäººæ•°æ®å¯¼å‡º (æ¥å£ `/passport/export` å·²å†™å¥½ï¼Œä½†æ²¡æƒ³å¥½å¦‚ä½•å¤„ç†å¥½å®‰å…¨é—®é¢˜ï¼Œå½“å‰æ‰€æœ‰æ¥å£éƒ½ä¼šè‡ªåŠ¨åˆ é™¤ `bduss` å’Œ `stoken` çš„å€¼ï¼Œä½†å¯¼å‡ºä¼šä¸å¯é¿å…åœ°éœ€è¦å¤„ç†è¿™ä¸ªé—®é¢˜)ï¼Œå¼ºçƒˆå»ºè®®é˜…è¯» readme.md çš„ [å¤‡ä»½](#å¤‡ä»½) éƒ¨åˆ†
- [ ] â€¦â€¦æ›´å¤šçš„æƒ³èµ·æ¥å†åŠ 

## æ›´å¤š

æ›´å¤šçš„ todo å’Œå·²çŸ¥ bug è¯·æŸ¥çœ‹å®æ—¶æ›´æ–°çš„ [Projects/TbSignâ¡ï¸](https://github.com/users/BANKA2017/projects/4)

## æ„Ÿè°¢

- [ç™¾åº¦è´´å§äº‘ç­¾åˆ°](https://github.com/MoeNetwork/Tieba-Cloud-Sign/)
- [Starry-OvO/aiotieba](https://github.com/Starry-OvO/aiotieba/)
